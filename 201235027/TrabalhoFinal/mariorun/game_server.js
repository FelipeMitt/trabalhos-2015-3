var io = require('socket.io').listen(8181);

var users = {};
var userCount = 0;
var bestScore = 0;

//===== MAP GRID ====
//TODO: MAP Generator
var grid = [[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,3,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,3,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,4,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,3,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,4,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,4,1,0,0,0],[0,3,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,3,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,4,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,3,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,3,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,4,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,3,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,4,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,4,1,0,0,0],[0,3,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,3,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,4,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,3,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,3,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,4,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,3,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,4,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,4,1,0,0,0],[0,3,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,3,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,4,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,3,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,3,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,4,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,3,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,4,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,4,1,0,0,0],[0,3,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,3,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,4,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,3,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,3,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,4,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,3,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,3,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,3,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,3,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,4,1,2],[0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,1,2],[0,0,0,0,3,0,0,0,0,1,2],[0,0,0,0,0,0,0,0,0,1,2],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]
];

io.on('connection', function (socket) {

    users[socket.id] = Math.round((new Date().getTime())*Math.random());
    userCount++;

    console.log("User conected! Online users: " + userCount);

    io.emit('updateStats', {'usersOn': userCount, 'bestScore': bestScore});

    socket.on('getMapAndId', function (data, fn) {
        fn({'id': users[socket.id], 'map': grid});
    });

    socket.on('bestScore', function (data) {
        if(data.id == users[socket.id]){
            if(data.score > bestScore) {
                bestScore = data.score;
                io.emit('updateStats', {'usersOn': userCount, 'bestScore': bestScore});
            }
        }
    });

    socket.on('playerAction', function (data) {
        if(data.id == users[socket.id])
            io.emit('newAction', data);
    });

    socket.on('disconnect', function () {
        if(socket.id in users){
            io.emit('playerExit', {'id': users[socket.id]});

            delete users[socket.id];

            userCount--;
            io.emit('updateStats', {'usersOn': userCount, 'bestScore': bestScore});
        }
    });

});